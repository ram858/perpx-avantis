import { type MessageBufferStrategy, ReconnectingWebSocket, ReconnectingWebSocketError, type ReconnectingWebSocketOptions } from "./_reconnecting_websocket.js";
import { HyperliquidEventTarget } from "./_hyperliquid_event_target.js";
import { WebSocketRequestDispatcher, WebSocketRequestError } from "./_websocket_request_dispatcher.js";
import type { IRequestTransport, ISubscriptionTransport, Subscription } from "../../base.js";
export { WebSocketRequestError };
export { type MessageBufferStrategy, ReconnectingWebSocketError, type ReconnectingWebSocketOptions };
/** Configuration options for the WebSocket transport layer. */
export interface WebSocketTransportOptions {
    /**
     * The WebSocket URL.
     * - Mainnet:
     *   - API: `wss://api.hyperliquid.xyz/ws`
     *   - RPC: `wss://rpc.hyperliquid.xyz/ws`
     * - Testnet:
     *   - API: `wss://api.hyperliquid-testnet.xyz/ws`
     *   - RPC: `wss://rpc.hyperliquid-testnet.xyz/ws`
     * @defaultValue `wss://api.hyperliquid.xyz/ws`
     */
    url?: string | URL;
    /**
     * Request timeout in ms.
     * Set to `null` to disable.
     * @defaultValue `10_000`
     */
    timeout?: number | null;
    /**
     * Keep-alive configuration.
     * @defaultValue `{ interval: 20_000 }`
     */
    keepAlive?: {
        /**
         * The interval in ms to send keep-alive messages.
         * Set to `null` to disable.
         * @defaultValue `20_000`
         */
        interval?: number | null;
    };
    /**
     * Reconnection policy configuration for closed connections.
     */
    reconnect?: ReconnectingWebSocketOptions;
}
/** WebSocket implementation of the REST and Subscription transport interfaces. */
export declare class WebSocketTransport implements IRequestTransport, ISubscriptionTransport, AsyncDisposable {
    /** The interval timer ID for keep-alive messages. */
    protected _keepAliveTimer: number | null;
    /** The WebSocket request dispatcher instance. */
    protected _wsRequester: WebSocketRequestDispatcher;
    /** The Hyperliquid event target instance. */
    protected _hlEvents: HyperliquidEventTarget;
    /**
     * Map of active subscriptions.
     * - Key: Unique subscription identifier based on payload
     * - Value: Subscription info containing the subscription request promise
     *   and a map of listeners to their metadata (channel + unsubscribe function).
     */
    protected _subscriptions: Map<string, {
        listeners: Map<(data: CustomEvent) => void, (signal?: AbortSignal) => Promise<void>>;
        requestPromise: Promise<unknown>;
    }>;
    /**
     * Request timeout in ms.
     * Set to `null` to disable.
     */
    timeout: number | null;
    /** Keep-alive configuration settings. */
    readonly keepAlive: {
        /**
         * The interval in ms to send keep-alive messages.
         * Set to `null` to disable.
         */
        readonly interval: number | null;
    };
    /** The WebSocket that is used for communication. */
    readonly socket: ReconnectingWebSocket;
    /**
     * Creates a new WebSocket transport instance.
     * @param options - Configuration options for the WebSocket transport layer.
     */
    constructor(options?: WebSocketTransportOptions);
    /**
     * Sends a request to the Hyperliquid API via WebSocket.
     * @param endpoint - The API endpoint to send the request to (`explorer` requests are not supported).
     * @param payload - The payload to send with the request.
     * @param signal - An optional abort signal.
     * @returns A promise that resolves with parsed JSON response body.
     * @throws {WebSocketRequestError} - An error that occurs when a WebSocket request fails.
     * @note Explorer requests are not supported in the Hyperliquid WebSocket API.
     */
    request(type: "info" | "exchange" | "explorer", payload: unknown, signal?: AbortSignal): Promise<unknown>;
    /**
     * Subscribes to a Hyperliquid event channel.
     * @param channel - The event channel to listen to.
     * @param payload - A payload to send with the subscription request.
     * @param listener - A function to call when the event is dispatched.
     * @param signal - An optional abort signal for canceling the subscription request.
     * @returns A promise that resolves with a {@link Subscription} object to manage the subscription lifecycle.
     */
    subscribe(channel: string, payload: unknown, listener: (data: CustomEvent) => void, signal?: AbortSignal): Promise<Subscription>;
    /**
     * Waits until the WebSocket connection is ready.
     * @param signal - An optional abort signal.
     * @returns A promise that resolves when the connection is ready.
     */
    ready(signal?: AbortSignal): Promise<void>;
    /**
     * Closes the WebSocket connection and waits until it is fully closed.
     * @param signal - An optional abort signal.
     * @returns A promise that resolves when the connection is fully closed.
     */
    close(signal?: AbortSignal): Promise<void>;
    /**
     * Combines the provided abort signal with the timeout signal.
     * @param signal An optional abort signal.
     * @returns A combined abort signal or undefined.
     */
    protected _getCombinedTimeoutSignal(signal?: AbortSignal): AbortSignal | undefined;
    [Symbol.asyncDispose](): Promise<void>;
}
//# sourceMappingURL=websocket_transport.d.ts.map